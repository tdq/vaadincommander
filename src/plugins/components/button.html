<link rel="import" href="component.html">

<script>
class Button extends Component {

    constructor(caption = null) {
        super();
        this._caption = caption;
    }

    getWidth() {
        return this._caption ? this._caption.length + 2 : 1;
    }

    getHeight() {
        return 1;
    }

    setClickListener(listener) {
        this._clickListener = listener;
    }

    render(api) {
        const bgcolor = this._focused ? 7 : super.getStyle().bgcolor || 0;
        const color = this._focused ? 0 : super.getStyle().color || 7;
        const width = this.getWidth();

        for(let i = 0; i < width; i++) {
            if(i == 0 || i == width - 1) {
                api.writeBufferAt(i, 0, {color: color, bgcolor: bgcolor});
            } else {
                api.writeBufferAt(i, 0, {value: this._caption.charAt(i - 1), color: color, bgcolor: bgcolor});
            }
        }

        api.addEventListener("keydown", e => {
            if(e.key === "Enter" && this._focused && this._clickListener) {
                e.preventDefault();

                this._clickListener();
            }
        });
    }
}
</script>
